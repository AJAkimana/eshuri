extends ../layout
block append scripts
	script(src="../js/MIT/jquery.select-bootstrap.js",type="application/javascript")
block content 
	.main-panel
		include ../partials/header 
		.wrapper.wrapper-full-page.full-page-background(ng-controller="course_registerCtrl",style="background-image: url('../imgs/register.jpeg')")
			.full-page.login-page
				.content
					.container-fluid
						.row
							.col-md-8.center
								.card
									.card-header.card-header-icon(data-background-color="rose")
										i.material-icons class
									.card-content
										.row
											.col-md-4
												.form-group.label-floating
													label.control-label Enter a new course
													input.form-control(type="text",autocomplete="off",ng-model="newCourse.name")
											.col.-md-2
												button.btn.btn-fill.btn-rose(ng-click="addCourse()") Add
											hr
											.col-md-12
												h3.text-center List of all courses at at <strong>{{school_name|uppercase}}</strong> 
												p.category These courses will be used in assigning them to classes and teachers
												.table-responsive(ng-show="courses.length")
													table.table
														thead
															th.text-center #
															th: a.btn-simple.btn.label.btn-rose(ng-click="a='name';b=!b") Course name
															th: a.btn-simple.btn.label.btn-rose(
															ng-click="a='academic_year';b=!b") Academic year
															th: a.btn-simple.btn.label.btn-rose.text-right Delete
														tbody
															tr(ng-repeat="course in courses |orderBy:a:b")
																td(width="1%" height="1%") {{$index + 1}}
																td: a(href="/dashboard.course/{{course._id}}")
																	strong {{course.name | uppercase}}
																td {{17|yearToDate}}
																td.td-actions.center
																	button.btn.btn-danger(type='button',ng-click="deleteCourse(course._id, course.name)")
																		i.material-icons close
												p.category.text-center(ng-show ="!courses.length") No class provided here
block append scripts
	script(src="../js/MIT/MIT_sweetalert2.js", type="text/javascript")
	script.
		var app =angular.module('eshuri_App', ['ngRoute']);
		app
		.filter('toTermName', function() {
			return function(input){
				return input=='S'?'Semester':'Term'
			}
		})
		.filter('yearToDate', function() {
			return function(input){
				input =Number(input)+2000;
				return input = input+'/'+Number(Number(input)+1);
			}
		})
		.controller('course_registerCtrl', function($scope,$http,$window){
			$scope.addCourse = function(){
				if(!$scope.newCourse)
					return Notifier.danger('You can\'t save course that has no name');
				$scope.newCourse.school_id = $scope.school_id;
				//console.log('my school id is:'+$scope.school_id+' and I am me')
				$http
				.post("/school.add.course", $scope.newCourse)
				.then(function(response){
					Notifier.success(angular.uppercase($scope.newCourse.name)+" has been added to the school courses");
					$scope.newCourse =null;
					$scope.getListCourses();
				})
				.catch(function(erreur){
					Notifier.danger(erreur.data);
				});
			}
			$scope.getListCourses = function(){
				$http
				.get("/school.course.list/"+$scope.school_id)
				.then(function(response){
					$scope.courses = response.data;
					//console.log($scope.school_name+' all courses '+$scope.courses)
				})
				.catch(function(erreur){
					Notifier.danger(erreur.data);
				});
			}
			$scope.deleteCourse = function(id, name){
				swal({
						title: 'Do you realy want to delete <span class="text-danger">'+angular.uppercase(name)+'</span>? <br> Won\'t be listed on courses list',
						//text: "This will impact marks!",
						type: 'warning',
						showCancelButton: true,
						confirmButtonClass: 'btn btn-success',
						cancelButtonClass: 'btn btn-danger',
						confirmButtonText: 'Yes, I am sure!',
						buttonsStyling: false
					}).then(function(){
					  	$http
						.post("/delete.school.course", {course_id:id})
						.then(function(response){
							$scope.getListCourses();
							Notifier.success(angular.uppercase(name)+" has been deleted");
						})
						.catch(function(erreur){
							Notifier.danger(erreur.data);
						});
					});
			}
			$scope.school_name ="#{school_name}";
			$scope.school_id ="#{school_id}";
			$scope.anti_csrf ="#{csrf_token}";
			$scope.getListCourses();
		});