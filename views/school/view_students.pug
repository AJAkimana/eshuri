extends ../layout
block append content 
	//- .main-panel
		include ../partials/header 
	.wrapper.wrapper-full-page.full-page-background(ng-controller="studentCtrl",style="background-image: url('../imgs/register.jpeg')")
		.full-page.login-page
			.content
				.container-fluid
					.row
						.col-md-8.center
							.card
								.card-header.card-header-icon(data-background-color="rose")
									i.material-icons supervisor_account
								.card-content
									h5.card-title Give higher privileges to a teacher
									.col-md-12.text-right
										a.btn-simple.btn.label.btn-rose(ng-click="addNew=!addNew") Add new student
											i.material-icons person_outline
									.col-md-12
										h3.text-center List of students at 
											strong {{'#{school_name}'|uppercase}}
											p
												strong(ng-bind="current_students")
												| Current students, 
												strong(ng-bind="finalists")
												| Finalists
										.table-responsive(ng-show="students.length")
											form.form-inline
												.form-group.pull-left
													label Show
													select.form-control(ng-init="n_pages=10", ng-model="n_pages", value="10")
														option(value="{{pag}}", ng-repeat="pag in pages") {{pag}}
													label /page
												.form-group.pull-right
													input.form-control(type='text', ng-model='search', placeholder='Search')
											table.table
												thead
													th.text-center #
													th: a.btn-simple.btn.label.btn-rose(ng-click="a='name';b=!b")  Name
													th: a.btn-simple.btn.label.btn-rose(ng-click="a='URN';b=!b")  URN
													th: a.btn-simple.btn.label.btn-rose(ng-click="a='email';b=!b")  E-mail
													th: a.btn-simple.btn.label.btn-rose(ng-click="a='classe';b=!b")  Student class
													//- th: a.btn-simple.btn.label.btn-rose Actions

												tbody
													tr(pagination-id="allstudents", dir-paginate="student in students |orderBy:a:b|filter:search|itemsPerPage:n_pages")
														td(width="1%" height="1%") {{$index + 1}}
														td {{student.name | uppercase}}
														td {{student.URN | uppercase}}
														td {{student.email }}
														td {{student.classe }}
														//- td.td-actions
															.card(ng-show="student.class_id==null")
																.card-content
																	| dsfds
											dir-pagination-controls.pull-right(pagination-id='allstudents', max-size='5', direction-links='true', boundary-links='true')
										p.category.text-center(ng-show ="!students.length") No students registered here
block append scripts
	script(src="../js/MIT/MIT_sweetalert2.js", type="text/javascript")
	script.
		var app =angular.module('eshuri_App', ['ngRoute', 'angularUtils.directives.dirPagination']);
		app
		.controller('studentCtrl', function($scope,$http){
			$scope.getListStudents = function(){
				$http
				.post("/school.students.json",{_csrf:$scope.anti_csrf,school_id:$scope.school_id })
				.then(function(response){
					$scope.students = response.data;
					$scope.finalists=0;
					$scope.current_students=0;
					for(var i=0; i<$scope.students.length; i++){
						if($scope.students[i].classe==="Finalist") $scope.finalists++;
						else $scope.current_students++;
					}
				})
				.catch(function(erreur){
					Notifier.danger(erreur.data);
				});
			}
			$scope.removeAdmin = function(admin_id, admin_name){
				$http
				.post("/school.teacher.to.admin",{_csrf:$scope.anti_csrf,admin_id:admin_id,school_id:$scope.school_id })
				.then(function(response){
					$scope.getListAdmins();
					$scope.getListTeachers();
					Notifier.success("Operation successful! "+admin_name.toUpperCase()+" is no longer admin.");
				})
				.catch(function(erreur){
					Notifier.danger(erreur.data);
				});
			}
			$scope.pages=[3,5,10,15,20,25];
			$scope.anti_csrf ="#{csrf_token}";
			$scope.school_id ="#{school_id}";
			$scope.getListStudents();
		})
