extends ../layout
block append content 
  //- .main-panel
    include ../partials/header
  .wrapper.wrapper-full-page.full-page-background(ng-controller="classTermCtrl",style="background-image: url('../imgs/register.jpeg')")
    .full-page.login-page
      .content
        .container-fluid
          .row
            .col-xs-12.col-sm-12.col-md-12.col-lg-12
              .col-xs-12.col-sm-8.col-md-6.col-lg-6
                .card
                  .card-header
                    h3.card-title 
                      strong {{'#{title}'|uppercase}}
                  .card-content
                    .panel-group(role='tablist')#accordion
                      .panel.panel-default(ng-repeat="term in [1,2,3]")
                        .panel-heading(role='tab', id="{{'tab_'+$index}}", ng-click="setCurrentTerm(term, $index)")
                          a(role='button', data-toggle='collapse', data-parent='#accordion', href="#{{'collapse_'+$index}}", aria-expanded="false", aria-controls="{{'collapse_'+$index}}")
                            h4.panel-title
                              | {{$index+1}}. {{term|toTermName}} {{$index+1}}
                              i.material-icons keyboard_arrow_down
                        .panel-collapse.collapse(role='tabpanel', aria-labelledby="{{'tab_'+$index}}", id="{{'collapse_'+$index}}")
                          .panel-body
                            .col-md-12
              .col-xs-12.col-sm-4.col-md-6.col-lg-6
                .card
                  .card-header
                    h3.card-title.text-center <strong>Classes</strong>
                    h2.card-title.text-center.text-info(ng-show="!classes.length") <strong>Loading ...</strong>
                  .card-content
                    .panel.panel-primary(ng-show="classes.length")
                      h3.panel-header.text-center Your available classes
                      .panel-body
                        .col-xs-12.col-sm-6.col-md-4.col-lg-4(ng-repeat="classe in classes")
                          h3
                            a(href='/classe/{{classe.class_id}}') {{classe.name|uppercase|toClasseName}}
                          h4 {{classe.number}} courses
                      .panel-footer
                        h4.text-center Number of class {{classes.length}}
block append scripts
  script(src="../js/MIT/MIT_sweetalert2.js", type="text/javascript")
  script(src="../js/MIT/jasny-bootstrap.min.js", type="text/javascript")
  script.
    var app =angular.module('eshuri_App', ['ngRoute']);
    app
    .filter('toTermName', function() {
      return function(input){ 
        return input=='S'?'Semester':'Term'
      }
    })
    .filter('toClasseName', function() {
      return function(input, term){
        return term=='S'?'Y'+input:'S'+input
      }
    })
    .controller('classTermCtrl',function($scope,$http,$window, $document){
      $scope.getUserClasses = function(){
        $http
        .get('/school.get.userClasses/'+$scope.school_id,{"_csrf":$scope.anti_csrf})
        .then(function(response){
          $scope.classes = response.data;
        })
        .catch(function(error){
          Notifier.danger(error.data)
        })
      }
      $scope.getCourses = function(){
        $http.get('/classe.get.courses/'+$scope.class_id+'/'+$scope.term_quantity)
        .then(function(response){
          var data = response.data;
          var t_q = 0;
          var term = [];
          for(var i=0; i<data.length; i++){
            if(term.indexOf(data[i].currentTerm)==-1){
              term.push(data[i].currentTerm)
              t_q++;
            }
          }
          console.log(JSON.stringify(t_q))
        })
        .catch(function(error){
          Notifier.danger(error.data)
        })
      }
      $scope.school_id ="#{school_id}";
      $scope.class_id ="#{class_id}";
      $scope.anti_csrf ="#{csrf_token}";
      $scope.term_quantity="#{term_quantity}";
      $scope.getUserClasses();
      $scope.getCourses();
    })
